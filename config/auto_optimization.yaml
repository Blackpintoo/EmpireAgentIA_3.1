# ============================================================================
# CONFIGURATION OPTIMISATION AUTOMATIQUE - EMPIRE AGENT IA v3
# ============================================================================
# Active : 2025-11-30
# Optimisation automatique des agents via Optuna
# ============================================================================

auto_optimization:
  # ========== ACTIVATION ==========
  enabled: true  # ✅ ACTIVÉ

  # ========== FRÉQUENCE ==========
  # Options : daily, weekly, biweekly, monthly
  frequency: weekly

  # ========== PLANNING ==========
  schedule:
    # Jour de la semaine (pour weekly/biweekly)
    # 0=Lundi, 1=Mardi, 2=Mercredi, 3=Jeudi, 4=Vendredi, 5=Samedi, 6=Dimanche
    day_of_week: 6  # Dimanche

    # Heure d'exécution (format 24h)
    time: "02:00"  # 02h00 du matin (période calme)

    # Timezone
    timezone: "Europe/Zurich"

  # ========== AGENTS À OPTIMISER ==========
  # Liste des agents à optimiser automatiquement
  agents:
    - scalping
    - swing
    - technical
    - structure
    - smart_money
    # news, sentiment, fundamental : pas d'hyperparamètres à optimiser

  # ========== SYMBOLES ==========
  # Optimiser séparément pour chaque symbole
  symbols:
    - BTCUSD
    - EURUSD
    - ETHUSD
    - XAUUSD
    - GBPUSD
    - USDJPY

  # ========== PARAMÈTRES OPTUNA ==========
  optuna:
    n_trials: 30           # Nombre d'essais par optimisation (réduit pour rapidité)
    timeout: 600           # Timeout par optimisation (10 minutes)
    n_jobs: 2              # Parallélisation (2 workers)
    sampler: "TPE"         # TPE (Tree-structured Parzen Estimator)
    pruner: "MedianPruner" # Arrêt précoce des essais non prometteurs

  # ========== CRITÈRES D'OPTIMISATION ==========
  objective:
    # Métrique principale à maximiser
    # Options: profit_factor, sharpe, sortino, calmar, expectancy
    primary: "profit_factor"

    # Métriques secondaires (contraintes)
    constraints:
      min_trades: 50          # Minimum 50 trades pour validation
      max_drawdown: 0.15      # Max 15% drawdown
      min_winrate: 0.50       # Min 50% win rate
      min_profit_factor: 1.3  # Min 1.3 profit factor

  # ========== DONNÉES BACKTEST ==========
  backtest:
    # Période de données pour optimisation
    lookback_days: 180  # 6 mois de données

    # Validation walk-forward
    validation_split: 0.3  # 30% pour validation

    # Timeframes à utiliser
    timeframes:
      - H1
      - M30
      - M15

  # ========== SAUVEGARDE ==========
  backup:
    # Sauvegarder configuration avant optimisation
    enabled: true

    # Répertoire backups
    directory: "data/optimization_backups"

    # Garder N derniers backups
    keep_last: 10

  # ========== NOTIFICATIONS ==========
  notifications:
    # Envoyer résultats par Telegram
    telegram: true

    # Notifier début optimisation
    notify_start: true

    # Notifier fin optimisation
    notify_end: true

    # Notifier si amélioration trouvée
    notify_improvement: true

    # Notifier si échec
    notify_failure: true

  # ========== MISE À JOUR AUTOMATIQUE ==========
  auto_apply:
    # Appliquer automatiquement les meilleurs paramètres
    enabled: true

    # Seuil d'amélioration minimum pour appliquer
    # Ex: 1.1 = +10% d'amélioration requise
    min_improvement: 1.05  # +5% minimum

    # Redémarrer orchestrateur après optimisation
    restart_orchestrator: false  # ⚠️ false = pas de redémarrage auto (sécurité)

  # ========== SÉCURITÉ ==========
  safety:
    # Maximum optimisations par jour
    max_per_day: 1

    # Pause entre optimisations (minutes)
    cooldown_minutes: 60

    # Bloquer optimisation si trading actif
    block_if_open_positions: true

    # Bloquer optimisation pendant heures de trading
    block_during_market_hours: true
    market_hours:
      start: "08:00"
      end: "22:00"

  # ========== LOGS ==========
  logging:
    enabled: true
    level: "INFO"
    file: "logs/auto_optimization.log"

# ============================================================================
# NOTES IMPORTANTES
# ============================================================================
#
# 1. FRÉQUENCE RECOMMANDÉE :
#    - Weekly : Bon équilibre (évite overfitting)
#    - Monthly : Plus conservateur
#    - Daily : ⚠️ DÉCONSEILLÉ (overfitting élevé)
#
# 2. DONNÉES MINIMALES :
#    - Attendre au moins 1 mois de données réelles avant optimisation
#    - lookback_days: 180 = besoin de 6 mois d'historique
#
# 3. AUTO_APPLY :
#    - enabled: true = applique automatiquement si amélioration
#    - min_improvement: 1.05 = +5% minimum requis
#    - restart_orchestrator: false = SÉCURITÉ (redémarrage manuel)
#
# 4. SÉCURITÉ :
#    - block_if_open_positions: true = pas d'optimisation si trades ouverts
#    - block_during_market_hours: true = optimise pendant heures calmes
#    - max_per_day: 1 = limite quotidienne
#
# 5. MONITORING :
#    - Telegram notifications activées
#    - Logs dans logs/auto_optimization.log
#    - Backups automatiques dans data/optimization_backups/
#
# ============================================================================
